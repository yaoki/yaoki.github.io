<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>DMM エロマンガ</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  </head>
  <body>
	  <div class="container">
	    <h1>FANZA エロマンガ キーワードサーチ</h1>
		<p>Adガードを無効にしてください。</p>
		<p><a href="https://affiliate.dmm.com/api/v3/itemlist.html" target="_blank" rel="noopener noreferrer">APIリファレンス</a></p>
	    <input type="text" class="form-control" id="set_keyword">
	    <div id="result"></div>
	</div>



	<!-- 以下 スクリプトのコーナー -->
    <!-- jQuery first, then Bootstrap JS. -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <script>
    $('#set_keyword').on('keyup', function(){
		dmmsearch($(this).val());
    });

    function dmmsearch(keyword){
	    //製品データを取得
		$.ajax({
		  url: 'https://api.dmm.com/affiliate/v3/ItemList',
		  dataType: 'jsonp',
		  data: {
		    api_id: 'HWpNtF4Bn0HyHmQaGVxC',
		    affiliate_id: 'pinktraktor-990',
		    site: 'FANZA',
		    service: 'ebook',
		    floor: 'comic',
		    hits: 30,
		    keyword: keyword,
		    output: 'json'
		  },
		  success: function(data) {
		    var result = '';
			$.each(data.result.items, function(index, item){
				var tachiyomi = (item.tachiyomi && item.tachiyomi.URL)
				  ? '<a href="' + item.tachiyomi.URL + '" target="_blank" rel="noopener noreferrer" class="btn btn-block btn-lg btn-primary">立ち読み</a>'
				  : '';
				result += '<div class="media">'
				+ '<div class="media-left">'
				+ '<img src="' + item.imageURL.small + '" class="media-object">'
				+ tachiyomi
				+ '</div>'
				+ '<div class="media-body">'
				+ '<h6 class="media-heading"><a href="' + item.URL  + '" target="_blank" rel="noopener noreferrer">' + item.title + '</a></h6>'
				+ '<p>' + item.date + '</p>'
				+ '<p>' + Number(item.prices.price).toLocaleString() + '円（税込）' + '</p>'
				+ '</div></div>';
			});
			//結果を出力する
			$('#result').html(result);
		  },
		  error: function(xhr, status, err) {
		    console.log('API error:', status, err);
		  }
		});
    }
  </script>
  </body>
</html>